(this.webpackJsonpmalloc=this.webpackJsonpmalloc||[]).push([[0],{242:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),r=n(32),s=n.n(r),o=(n(42),n(6)),l=n(1),c=(n(43),n(244)),u=n(243),m=n(5);var f=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),r=n[0],s=n[1],o=Object(a.useState)(!1),f=Object(l.a)(o,2),d=f[0],y=f[1],h=Object(a.useState)(!1),p=Object(l.a)(h,2),v=p[0],b=p[1],g=Object(m.b)((function(){return{marginLeft:-10}})),w=Object(l.a)(g,2),E=w[0].marginLeft;(0,w[1])({marginLeft:""!==r||d||v?0:-10});var S=Object(m.b)((function(){return{marginRight:10}})),$=Object(l.a)(S,2),T=$[0].marginRight;return(0,$[1])({marginRight:""!==r||d||v?0:10}),i.a.createElement("div",{className:"command-input-container"},i.a.createElement(m.a.div,{className:"command-input-arrow",style:{marginLeft:E,marginRight:T}},">"),i.a.createElement("div",{className:"command-input",onMouseEnter:function(){b(!0)},onMouseLeave:function(){b(!1)}},i.a.createElement("div",{className:"code-render"},i.a.createElement("span",{style:{opacity:.5}},i.a.createElement(c.a,{language:"c",style:u.a},e.getPrediction(r)))),i.a.createElement("div",{className:"code-render"},i.a.createElement(c.a,{language:"c",style:u.a},r)),i.a.createElement("input",{spellCheck:"false",value:r,onChange:function(e){s(e.currentTarget.value)},onFocus:function(){y(!0)},onBlur:function(){y(!1)},onKeyDown:function(t){if("Tab"!==t.key){if("Enter"===t.key){if(""===r)return;return e.onCommand(r),void s("")}}else{t.preventDefault();var n=e.getPrediction(r);s(n)}}})))};function d(e){return i.a.createElement("div",{className:"command-history-item ".concat(e.historyItem.style)},"command"!==e.historyItem.style?e.historyItem.text.replace(/ /g," ").split("\n").map((function(e,t){return i.a.createElement("span",{key:t},e,i.a.createElement("br",null))})):i.a.createElement("div",{className:"code-render"},i.a.createElement(c.a,{language:"c",style:u.a},e.historyItem.text)))}var y=function(e){var t=Object(a.useState)(0),n=Object(l.a)(t,2),r=n[0],s=n[1];return Object(a.useEffect)((function(){if(r!==e.history.length){s(e.history.length);var t=document.querySelector(".command-history-container");t.scrollTop=t.scrollHeight}}),[r,e.history.length]),i.a.createElement("div",{className:"command-history-container"},e.history.map((function(e,t){return i.a.createElement(d,{key:t,historyItem:e,index:t})})))};var h=function(e){var t=Object(a.useState)(200),n=Object(l.a)(t,2),r=n[0],s=n[1],o=Object(m.b)((function(){return{height:300,config:{mass:1,tension:540,friction:56}}})),c=Object(l.a)(o,2),u=c[0].height,d=c[1];return r!==e.height&&(s(e.height),d({height:e.height})),i.a.createElement(m.a.div,{className:"command-area",style:{height:u}},i.a.createElement(y,{history:e.commandHistory}),i.a.createElement(f,{getPrediction:e.getPrediction,onCommand:function(t){return e.onCommand(t)}}))};var p=function(e){return i.a.createElement("div",{className:"cell-container"+(e.cellState.isAllocated?" allocated":" unallocated")+(e.cellState.isReserved?" reserved":" unreserved")})};var v=function(e){return i.a.createElement("span",{className:"memory-block-container"},e.blockState.cells.map((function(e,t){return i.a.createElement(p,{key:t,cellState:e})})))};var b=function(e){return i.a.createElement("div",{className:"memory-container"},e.memState.blocks.map((function(e,t){return i.a.createElement(v,{key:t,blockState:e})})))},g=n(18),w=n.n(g),E=n(2),S=n(4),$=function(){function e(){Object(E.a)(this,e),console.log(window.devicePixelRatio),console.log(document.querySelector("body").clientWidth),this.memorySize=5*Math.floor(document.querySelector("body").clientWidth/46),this.reset()}return Object(S.a)(e,[{key:"reset",value:function(){var e=this;this.state=[];for(var t=0;t<this.memorySize;t++)this.state.push({isAllocated:!1,isReserved:!1});this.state[0].isReserved=!0,this.variables={help:{nodeType:"variable",type:"function",value:function(){return"\n- Commands use C-style syntax.\n- Variable declaration and assignment is supported.\n- Intelligent live suggestions are provided. You can use tab to insert a suggestion.\n- The following functions are available:\n  - malloc(int)\n  - free(int)\n  - coalesce()\n  - reset()\n  - clearConsole()\n  - setMemorySize(int)"}},reset:{nodeType:"variable",type:"function",value:function(){return e.reset(),{nodeType:"variable",actionHadSideEffect:!0,type:"int",value:void 0}}},clearConsole:{nodeType:"variable",type:"function",value:function(){return{nodeType:"ui-action",action:"clearConsole"}}},malloc:{nodeType:"variable",type:"function",value:function(t){return{nodeType:"variable",actionHadSideEffect:!0,type:"int",value:e.malloc(t)}}},free:{nodeType:"variable",type:"function",value:function(t){return e.free(t),{nodeType:"variable",actionHadSideEffect:!0,type:"int",value:void 0}}},setMemorySize:{nodeType:"variable",type:"function",value:function(t){return e.setMemorySize(t),{nodeType:"variable",actionHadSideEffect:!0,type:"int",value:void 0}}},coalesce:{nodeType:"variable",type:"function",value:function(t){return e.coalesce(),{nodeType:"variable",actionHadSideEffect:!0,type:"int",value:void 0}}}}}},{key:"getIdentifiers",value:function(){return Object.keys(this.variables)}},{key:"getFunctions",value:function(){var e=this;return Object.keys(this.variables).filter((function(t){return"function"===e.variables[t].type}))}},{key:"malloc",value:function(e){if("string"===typeof e&&(e=parseInt(e)),0===e)throw new Error("Runtime exception in malloc():\n  Size cannot be zero.");if(e<0)throw new Error("Runtime exception in malloc():\n  Size cannot be negative.");for(var t,n=0,a=0;a<this.state.length;a++)if(this.state[a].isAllocated||this.state[a].isReserved)n=0;else if(++n===e){t=a-n;break}if(void 0===t)throw new Error("Runtime exception in malloc(): Out of memory.");for(var i=t;i<=t+e;i++)this.state[i].isAllocated=!0;this.state[t].isReserved=!0;var r=this.state[t].cellValue;return this.state[t].cellValue=t+e+1,void 0===this.state[t+e+1]||this.state[t+e+1].isReserved||(this.state[t+e+1].isReserved=!0,this.state[t+e+1].cellValue=r),t+1}},{key:"free",value:function(e){if(void 0===this.state[e-1])throw new Error("Runtime exception in free():\n  Memory pointer is out of bounds.");if(!this.state[e-1].isReserved||!this.state[e-1].isAllocated)throw new Error("Runtime exception in free():\n  Memory pointer does not point to the start of an allocated chunk.");this.state[e-1].isAllocated=!1;for(var t=e;t<this.state.length&&!this.state[t].isReserved;t++)this.state[t].isAllocated=!1}},{key:"setMemorySize",value:function(e){if(e<1)throw new Error("Runtime exception in setMemorySize(): Memory size must be at least 1.");if(e!==this.memorySize){if(e>this.memorySize)for(var t=0;t<e-this.memorySize;t++)0===t&&this.state[this.memorySize-1].isAllocated?this.state.push({isAllocated:!1,isReserved:!0}):this.state.push({isAllocated:!1,isReserved:!1});else{this.state=this.state.slice(0,e);for(var n=this.state.size-1;n>=0;n--)if(this.state[n].isReserved){this.state[n].next=void 0;break}}this.memorySize=e}}},{key:"coalesce",value:function(){for(var e=0;!(e>=this.state.length)&&!(void 0===this.state[e].cellValue||this.state[e].cellValue<0||this.state[e].cellValue>=this.state.length);)if(this.state[e].isAllocated||this.state[this.state[e].cellValue].isAllocated)e=this.state[e].cellValue;else{var t=this.state[e].cellValue;this.state[e].cellValue=this.state[t].cellValue,this.state[t].cellValue=void 0,this.state[t].isReserved=!1}}},{key:"getState",value:function(){var e,t={};t.blocks=[];for(var n=!0,a=0;a<this.state.length;a++)n&&(void 0!==e&&t.blocks.push(e),(e={cells:[]}).isAllocated=this.state[a].isAllocated),e.cells.push(this.state[a]),n=a+1<this.state.length&&this.state[a+1].isReserved;return t.blocks.push(e),t}},{key:"evaluate",value:function(e){if(Array.isArray(e)){if(0===e.length)throw new Error("Parsing error: Command is incomplete.\n  Did you forget a ')'?");return this.evaluate(e[0])}switch(e.nodeType){case"literal":return this.evaluate(e.literal);case"number":return e.number;case"statement":return this.evaluate(e.statement);case"identifier":if(!this.variables.hasOwnProperty(e.identifier))throw new Error("Reference error: '".concat(e.identifier,"' is not defined."));return this.variables[e.identifier];case"whiteSpace":return;case"assignment":var t;if("identifier"===e.left.nodeType){if(t=e.left.identifier,void 0===this.variables[t])throw new Error("Reference error: '".concat(t,"' is not defined."))}else"declaration"===e.left.nodeType&&(t=this.evaluate(e.left).identifier);var n=this.evaluate(e.right);return"variable"===n.nodeType?(this.variables[t].type=n.type,this.variables[t].value=n.value):(this.variables[t].type="int",this.variables[t].value=n),n;case"functionCall":var a=this.evaluate(e.functionName);if("function"!==a.type)throw new Error("Type error: '".concat(e.functionName.identifier,"' is not a function."));var i=e.argument?this.evaluate(e.argument):void 0;return a.value(void 0!==i&&"variable"===i.nodeType?i.value:i);case"declaration":var r=this.evaluate(e.type),s=e.identifier.identifier;if(void 0!==this.variables[s])throw new Error("Syntax error: Identifier '".concat(s,"' has already been declared."));return this.variables[s]={nodeType:"variable",type:r,value:void 0},e.identifier;case"type":return e.type}}}]),e}();var T=function(e){var t=Object(a.useState)(300),n=Object(l.a)(t,2),r=n[0],s=n[1],c=Object(a.useState)(!1),u=Object(l.a)(c,2),m=u[0],f=u[1],d=Object(a.useState)([]),y=Object(l.a)(d,2),p=y[0],v=y[1],g=Object(a.useState)([]),E=Object(l.a)(g,2),S=E[0],T=E[1];return void 0===window.engine&&(window.engine=new $,T(window.engine.getState())),0===p.length&&v([{style:"info",text:"-> Type help() for usage."}]),i.a.createElement("div",{className:"App",style:{cursor:m?"ns-resize":void 0},onMouseMove:function(e){if(m){var t=document.querySelector("body").clientHeight,n=t-e.pageY;n<250?n=250:n>4*t/7&&(n=4*t/7),s(n-=3)}},onMouseUp:function(){f(!1)}},i.a.createElement("div",{className:"mainContent",style:{flex:1}},i.a.createElement(b,{memState:S})),i.a.createElement("div",{className:"spacer",onMouseDown:function(){f(!0)},style:{height:6}}),i.a.createElement(h,{height:r,commandHistory:p,getPrediction:function(e){var t=e.split(" "),n=t[t.length-1],a=e.split("("),i=a[a.length-1];if(""===n||""===i)return e;var r=window.engine.getIdentifiers(),s=window.engine.getFunctions(),o=["malloc","free","setMemorySize"].map((function(e){return e+"("})).concat(["help","reset","clearConsole","coalesce"].map((function(e){return e+"()"}))).concat(r.filter((function(e){return!s.includes(e)})));o=o.sort();var l=!0,c=!1,u=void 0;try{for(var m,f=o[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var d=m.value;if(d.startsWith(n))return t[t.length-1]=d,t.join(" ");if(d.startsWith(i))return a[a.length-1]=d,a.join("(")}}catch(y){c=!0,u=y}finally{try{l||null==f.return||f.return()}finally{if(c)throw u}}return e},onCommand:function(e){var t=[];t.push({style:"command",text:e});var n={Lexer:void 0,ParserRules:[{name:"Main",symbols:["statement"]},{name:"Main",symbols:["statement","_",{literal:";",pos:12}]},{name:"statement",symbols:["literal"]},{name:"statement",symbols:["identifier"]},{name:"statement",symbols:["assignment"]},{name:"statement",symbols:["functionCall"]},{name:"statement",symbols:["declaration"]},{name:"statement",symbols:["_"],postprocess:function(e){return{nodeType:"statement",statement:e[0]}}},{name:"number$ebnf$1",symbols:[/[0-9]/]},{name:"number$ebnf$1",symbols:[/[0-9]/,"number$ebnf$1"],postprocess:function(e){return[e[0]].concat(e[1])}},{name:"number",symbols:["number$ebnf$1"],postprocess:function(e){return{nodeType:"number",number:e[0].join().replace(/,/g,"")}}},{name:"literal",symbols:["number"],postprocess:function(e){return{nodeType:"literal",literal:e[0]}}},{name:"identifier$ebnf$1",symbols:[]},{name:"identifier$ebnf$1",symbols:[/[a-zA-Z0-9_]/,"identifier$ebnf$1"],postprocess:function(e){return[e[0]].concat(e[1])}},{name:"identifier",symbols:[/[a-zA-Z_]/,"identifier$ebnf$1"],postprocess:function(e){return{nodeType:"identifier",identifier:(e[0]+e[1]).replace(/,/g,"")}}},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:[/[ ]/,"_$ebnf$1"],postprocess:function(e){return[e[0]].concat(e[1])}},{name:"_",symbols:["_$ebnf$1"],postprocess:function(e){return{nodeType:"whiteSpace"}}},{name:"assignment$subexpression$1",symbols:["declaration"]},{name:"assignment$subexpression$1",symbols:["identifier"]},{name:"assignment",symbols:["assignment$subexpression$1","_",{literal:"=",pos:93},"_","statement"],postprocess:function(e){return{nodeType:"assignment",left:e[0][0],right:e[4][0]}}},{name:"functionCall",symbols:["identifier","_",{literal:"(",pos:109},"_","statement","_",{literal:")",pos:117}],postprocess:function(e){return{nodeType:"functionCall",functionName:e[0],argument:"whiteSpace"===e[4]?e[4]:e[4][0]}}},{name:"declaration",symbols:["type","_","identifier"],postprocess:function(e){return{nodeType:"declaration",type:e[0],identifier:e[2]}}},{name:"type$string$1",symbols:[{literal:"i"},{literal:"n"},{literal:"t"}],postprocess:function(e){return e.join("")}},{name:"type",symbols:["type$string$1"]},{name:"type$subexpression$1$string$1",symbols:[{literal:"i"},{literal:"n"},{literal:"t"}],postprocess:function(e){return e.join("")}},{name:"type$subexpression$1",symbols:["type$subexpression$1$string$1","_",{literal:"*",pos:146}]},{name:"type",symbols:["type$subexpression$1"],postprocess:function(e){return{nodeType:"type",type:Array.isArray(e[0])?e[0][0]+e[0][2]:e[0]}}}],ParserStart:"Main"},a=new w.a.Parser(w.a.Grammar.fromCompiled(n)),i=!1;try{a.feed(e.trim())}catch(s){i=!0,t.push({style:"error",text:s.message.slice(0,s.message.search("Instead, ")).replace(/line [0-9]+ /,"")})}if(!i)try{var r=window.engine.evaluate(a.results);if(r.actionHadSideEffect&&T(window.engine.getState()),void 0!==r&&""!==r.toString())if("variable"===r.nodeType)r=r.value;else if("identifier"===r.nodeType)r=void 0;else if("ui-action"===r.nodeType){if("clearConsole"===r.action)return void v([]);throw new Error("Internal error: Unsupported UI action.")}void 0===r&&(r="null"),t.push({style:"info",text:"-> ".concat(r.toString())})}catch(s){t.push({style:"error",text:s.message})}v([].concat(Object(o.a)(p),t))}}))};s.a.render(i.a.createElement(T,null),document.getElementById("root"))},37:function(e,t,n){e.exports=n(242)},42:function(e,t,n){},43:function(e,t,n){}},[[37,1,2]]]);
//# sourceMappingURL=main.7cd53e68.chunk.js.map